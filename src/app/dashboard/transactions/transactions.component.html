<div class="transactions-container">
  <!-- Page Header -->
  <div class="page-header">
    <div class="header-content">
      <button mat-icon-button class="back-btn" (click)="goBack()">
        <mat-icon>arrow_back</mat-icon>
      </button>
      <div class="header-text">
        <h1>Transactions</h1>
        <p>Manage your income, expenses, and goal contributions</p>
      </div>
    </div>
    <div class="header-stats">
      <div class="stat-item">
        <span class="stat-value">{{ transactions.length || 0 }}</span>
        <span class="stat-label">Total</span>
      </div>
      <div class="stat-item">
        <span class="stat-value">â‚±{{ getTotalAmount() }}</span>
        <span class="stat-label">Amount</span>
      </div>
    </div>
  </div>

  <!-- Form Section -->
  <div class="form-section">
    <div class="form-header">
      <div>
        <mat-icon>add_circle</mat-icon>
        <h2>Add New Transaction</h2>
      </div>
    </div>

    <form [formGroup]="transactionForm" (ngSubmit)="onSubmit()" class="transaction-form">
      <div class="form-row">
        <div class="form-field">
          <label>Type</label>
          <select formControlName="type">
            <option value="">-- Select Type --</option>
            <option value="income">Income</option>
            <option value="expense">Expense</option>
            <option value="goals">Goals</option>
          </select>
        </div>

        <div class="form-field">
          <label>Category</label>
          <!-- WHEN type === 'goals' : show goals list -->
          @if (transactionForm.get('type')?.value === 'goals') {
            <select formControlName="category">
              <option value="">-- Select Goal --</option>
              @for (cat of availableCategories; track cat) {
                <option [value]="cat.id">{{ cat.name }}</option>
              }
            </select>
            @if (loading.isLoading()) {
              <div class="helper">Loading goals...</div>
            }
            @if (!loading.isLoading() && availableCategories.length === 0) {
              <div class="helper">
                No goals found. <a routerLink="/goals">Create a goal</a>
              </div>
            }
          } @else {
            <select formControlName="category">
              <option value="">-- Select Category --</option>
              @for (cat of availableCategories; track cat) {
                <option [value]="cat.id">{{ cat.name }}</option>
              }
            </select>
          }
          <!-- default (income / expense) -->
        </div>
      </div>

      <div class="form-row">
        <div class="form-field">
          <label>Amount</label>
          <input type="number" formControlName="amount" placeholder="Enter amount" />
        </div>

        <div class="form-field">
          <label>Date</label>
          <input type="date" formControlName="date" />
        </div>
      </div>

      <div class="form-actions">
        <button mat-raised-button type="submit" [disabled]="transactionForm.invalid">
          <mat-icon>add</mat-icon>
          Add Transaction
        </button>
      </div>
    </form>
  </div>

  <!-- Transactions Section -->
  <div class="transactions-section">
    <div class="section-header">
      <div class="section-title">
        <mat-icon>history</mat-icon>
        <h2>Transaction History</h2>
      </div>
      <div class="transactions-count">
        {{ transactions.length || 0 }} transactions
      </div>
    </div>

    @if (!loading.isLoading() && transactions.length > 0) {
      <div class="transactions-grid">
        @for (t of transactions; track t) {
          <div class="transaction-card">
            <div class="transaction-header">
              <div class="transaction-info">
                <div class="transaction-type">
                  <span class="type-badge" [ngClass]="t.type">{{ t.type | titlecase }}</span>
                </div>
                <div class="transaction-category">
                  @if (t.type === 'goals') {
                    {{ t.goalName || t.goalId }}
                  }
                  @if (t.type !== 'goals') {
                    {{ t.categoryName || t.category || t.categoryId }}
                  }
                </div>
              </div>
            </div>
            <div class="transaction-details">
              <div class="amount-item">
                <span class="amount-label">Amount</span>
                <span class="amount-value" [ngClass]="{positive: t.type === 'income', negative: t.type === 'expense'}">â‚±{{ t.amount }}</span>
              </div>
              <div class="date-item">
                <span class="date-label">Date</span>
                <span class="date-value">{{ t.date }}</span>
              </div>
            </div>
          </div>
        }
      </div>
    }

    @if (loading.isLoading()) {
      <div class="spinner-container">
        <mat-progress-spinner mode="indeterminate" diameter="48"></mat-progress-spinner>
      </div>
    }

    @if (!loading.isLoading() && transactions.length === 0) {
      <div class="empty">
        <div class="empty-icon">ðŸ’³</div>
        <div class="empty-title">No transactions yet</div>
        <div class="empty-subtitle">Add your first transaction to get started</div>
      </div>
    }
  </div>
</div>