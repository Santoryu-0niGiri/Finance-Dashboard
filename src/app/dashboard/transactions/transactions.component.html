<div class="transactions-container">
  <div class="top-row">
    <button type="button" class="back-btn" (click)="goBack()">⬅ Back to Dashboard</button>

    <!-- ✅ Add Goals button -->
    <button type="button" class="add-goal-btn" (click)="goToGoals()">➕ Add Goals</button>
  </div>

  <!-- Add Transaction Form -->
  <form [formGroup]="transactionForm" (ngSubmit)="onSubmit()" class="tx-form">
    <div class="row">
      <label>Type</label>
      <select formControlName="type">
        <option value="">-- Select Type --</option>
        <option value="income">Income</option>
        <option value="expense">Expense</option>
        <option value="goals">Goals</option>
      </select>
    </div>

    <div class="row">
      <label>Category</label>

      <!-- WHEN type === 'goals' : show goals list -->
      <ng-container *ngIf="transactionForm.get('type')?.value === 'goals'; else normalCategory">
        <select formControlName="category" [disabled]="loadingGoals || availableCategories.length === 0">
          <option value="">-- Select Goal --</option>
          <option *ngFor="let cat of availableCategories" [value]="cat.id">{{ cat.name }}</option>
        </select>

        <div class="helper" *ngIf="loadingGoals">Loading goals...</div>
        <div class="helper" *ngIf="!loadingGoals && availableCategories.length === 0">
          No goals found. <a routerLink="/goals">Create a goal</a>
        </div>
      </ng-container>

      <!-- default (income / expense) -->
      <ng-template #normalCategory>
        <select formControlName="category" [disabled]="availableCategories.length === 0">
          <option value="">-- Select Category --</option>
          <option *ngFor="let cat of availableCategories" [value]="cat.id">{{ cat.name }}</option>
        </select>
      </ng-template>
    </div>

    <div class="row">
      <label>Amount</label>
      <input type="number" formControlName="amount" placeholder="Enter amount" />
    </div>

    <div class="row">
      <label>Date</label>
      <input type="date" formControlName="date" />
    </div>

    <div class="actions">
      <button type="submit" [disabled]="transactionForm.invalid">Add Transaction</button>
    </div>
  </form>

  <hr />

  <!-- Transaction History -->
  <h3>Transaction History</h3>
  <ul class="tx-list">
    <li *ngFor="let t of transactions">
      <span class="type">{{ t.type | titlecase }}</span>
      <span class="category">
        <ng-container *ngIf="t.type === 'goals'">
          {{ t.goalName || t.goalId }}
        </ng-container>
        <ng-container *ngIf="t.type !== 'goals'">
          {{ t.categoryName || t.category || t.categoryId }}
        </ng-container>
      </span>
      <span class="amount">₱{{ t.amount }}</span>
      <span class="date">{{ t.date }}</span>
    </li>
  </ul>

  <div *ngIf="transactions?.length === 0" class="empty">
    No transactions yet.
  </div>
</div>
